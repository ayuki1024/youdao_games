<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>探索者号：火星任务 (多人无限制最终版)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+SC:wght@300;400&family=Source+Code+Pro:wght@400;700&display=swap');
        :root {
            --space-bg: #000411; --holo-primary: #00ffff; --holo-secondary: #ff00ff;
            --holo-success: #00ff7f; --text-light: #e0e0e0; --panel-bg: rgba(20, 15, 40, 0.85);
            --holo-error: #ff5555;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Noto Sans SC', sans-serif; background-color: var(--space-bg);
            color: var(--text-light); display: flex; justify-content: center; align-items: center;
            min-height: 100vh; padding: 20px; overflow: hidden; position: relative;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%;
            background-image: radial-gradient(white, rgba(255,255,255,0) 0.5px), radial-gradient(white, rgba(255,255,255,0) 1px);
            background-size: 500px 500px, 300px 300px;
            animation: stars 200s linear infinite; z-index: -1;
        }
        @keyframes stars { from { transform: translateY(0); } to { transform: translateY(-2000px); } }
        
        .container { display: flex; gap: 20px; width: 100%; max-width: 1600px; height: calc(100vh - 40px); }
        .ship-bridge { flex: 1; display: flex; flex-direction: column; gap: 20px; }
        .main-viewscreen { background: var(--panel-bg); border: 1px solid var(--holo-primary); border-radius: 8px; padding: 20px; backdrop-filter: blur(10px); flex: 1; display: flex; justify-content: center; align-items: center; }
        .ascii-chart-container { flex: 0 0 40%; background: var(--panel-bg); border: 1px solid var(--holo-primary); border-radius: 8px; padding: 20px; overflow-y: auto; }
        #ascii-table { width: 100%; border-collapse: collapse; }
        #ascii-table td { border: 1px solid rgba(0, 255, 255, 0.3); padding: 8px; text-align: center; font-family: 'Source Code Pro', monospace; }
        #ascii-table .gutter { border: none; width: 20px; }

        .login-interface { display: flex; flex-direction: column; align-items: center; gap: 15px; width: 100%; height: 100%; padding: 20px;}
        .login-title { font-family: 'Orbitron', sans-serif; font-size: 2.2em; color: var(--holo-primary); margin-bottom: 10px; }
        .instructions { font-size: 1.1em; max-width: 90%; text-align: center; color: var(--text-light); }
        .login-form { display: flex; flex-direction: column; gap: 20px; margin-top: 20px; width: 100%; max-width: 400px; }
        .input-group { display: flex; flex-direction: column; gap: 5px; }
        .input-group label { font-family: 'Orbitron'; font-size: 1.2em; color: var(--holo-primary); }
        .holo-input { font-family: 'Orbitron', sans-serif; background: rgba(0,0,0,0.3); border: 2px solid var(--holo-primary); padding: 15px; font-size: 1.5em; color: var(--text-light); text-align: center; border-radius: 5px; transition: border-color 0.3s; }
        .holo-input:focus { outline: none; border-color: var(--holo-secondary); }
        .holo-button { font-family: 'Orbitron', sans-serif; font-size: 1.2em; padding: 15px 30px; margin-top: 10px; border: 2px solid var(--holo-primary); color: var(--holo-primary); background: transparent; cursor: pointer; border-radius: 5px; transition: all 0.3s ease; }
        .holo-button:hover { background: var(--holo-primary); color: var(--space-bg); box-shadow: 0 0 15px var(--holo-primary); }
        .launch-button { border-color: var(--holo-success); color: var(--holo-success); }
        .launch-button:hover { background: var(--holo-success); color: var(--space-bg); box-shadow: 0 0 15px var(--holo-success); }
        #status-message { height: 30px; font-size: 1.1em; font-family: 'Orbitron'; transition: color 0.3s; text-align: center; }
        .status-success { color: var(--holo-success); }
        .status-error { color: var(--holo-error); }
        
        #boarded-crew-list { margin-top: 20px; width: 100%; max-width: 450px; }
        #boarded-crew-list h3 { font-family: 'Orbitron'; text-align: center; color: var(--holo-primary); }
        #crew-names { list-style: none; padding: 10px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; background: rgba(0,0,0,0.2); border-radius: 5px; min-height: 50px; max-height: 150px; overflow-y: auto;}
        #crew-names li { background: var(--holo-success); color: var(--space-bg); font-family: 'Orbitron'; padding: 5px 15px; border-radius: 3px; }

        #mission-briefing-modal { /* (No changes) */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center; z-index: 100;
        }
        .briefing-content { background: var(--panel-bg); border: 2px solid var(--holo-primary); padding: 40px; border-radius: 10px; max-width: 800px; text-align: center; animation: fadeIn 1s; position: relative; }
        .briefing-content h1 { font-size: 2.5em; color: var(--holo-primary); }
        .briefing-content p { font-size: 1.2em; line-height: 1.8; margin: 20px 0; }
        
        #solar-system { /* (No changes) */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden; background: var(--space-bg); z-index: 99;
        }
        .sun, .orbit, .planet, #rocket { position: absolute; }
        .sun { width: 12vmin; height: 12vmin; top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 50%; background: #ffd700; box-shadow: 0 0 8vmin #ff8c00; }
        .orbit { border: 1px solid rgba(255,255,255,0.1); border-radius: 50%; top: 50%; left: 50%; }
        .planet { border-radius: 50%; }
        #orbit-earth { width: 60vmin; height: 60vmin; transform: translate(-50%, -50%); }
        #planet-earth { width: 4vmin; height: 4vmin; background: #66ccff; }
        #orbit-mars { width: 90vmin; height: 90vmin; transform: translate(-50%, -50%); }
        #planet-mars { width: 3vmin; height: 3vmin; background: #c1440e; }
        #rocket { width: 3vmin; height: 1.5vmin; background-image: linear-gradient(to right, #e0e0e0, #ffffff); border-radius: 50%; opacity: 0; transition: opacity 0.5s; transform-origin: center center; }
        #rocket::after { content: ''; position: absolute; top: 50%; left: -1.5vmin; transform: translateY(-50%); width: 0; height: 0; border-top: 0.5vmin solid transparent; border-bottom: 0.5vmin solid transparent; border-right: 2vmin solid #ff8c00; opacity: 0; transition: opacity 0.2s; }
        .rocket-thrust #rocket::after { opacity: 1; animation: flicker 0.1s infinite; }
        #animation-text { position: absolute; top: 15%; width: 100%; text-align: center; font-family: 'Orbitron'; font-size: 2em; color: var(--holo-primary); opacity: 0; transition: opacity 1s ease-in-out; }

        @keyframes flicker { 0% { transform: translateY(-50%) scale(1); } 50% { transform: translateY(-50%) scale(1.2); } 100% { transform: translateY(-50%) scale(1); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="mission-briefing-modal">
        <div class="briefing-content">
            <h1>任务简报：探索者二号</h1>
            <p>各位船员，欢迎来到“探索者二号”发射中心。我们的火星殖民任务即将开始！</p>
            <p>为确保安全，请输入您的**个人身份ID (如姓名大写拼音)**，并使用右侧手册查找其对应的**ASCII激活码 (所有ASCII码顺序拼接)** 完成验证，获取登船许可。</p>
            <button id="begin-mission-btn" class="holo-button">我已准备就绪，开始登船</button>
        </div>
    </div>
    
    <div id="solar-system" class="hidden">
        <!-- Animation elements (no changes) -->
        <div class="sun"></div>
        <div id="orbit-earth" class="orbit"></div><div id="planet-earth" class="planet"></div>
        <div id="orbit-mars" class="orbit"></div><div id="planet-mars" class="planet"></div>
        <div id="rocket"></div>
        <div id="animation-text"></div>
    </div>

    <div class="container hidden" id="game-container">
        <div class="ship-bridge">
            <div id="main-viewscreen" class="main-viewscreen">
                <!-- 登录界面将由JS动态生成在这里 -->
            </div>
        </div>
        <aside class="ascii-chart-container">
            <h2 style="text-align:center; font-family: 'Orbitron';">通用协议手册</h2>
            <table id="ascii-table"></table>
        </aside>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 元素获取 ---
            const briefingModal = document.getElementById('mission-briefing-modal');
            const beginMissionBtn = document.getElementById('begin-mission-btn');
            const gameContainer = document.getElementById('game-container');
            const viewscreen = document.getElementById('main-viewscreen');
            const asciiTable = document.getElementById('ascii-table');
            
            // --- 游戏状态 ---
            const boardedCrew = [];
            const CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'.split('');
            let animationFrameId = null;

            // --- 游戏主流程 ---
            beginMissionBtn.addEventListener('click', () => {
                briefingModal.style.display = 'none';
                gameContainer.classList.remove('hidden');
                initGame();
            });

            function initGame() {
                generateAsciiTable();
                initLoginView();
            }

            function initLoginView() {
                viewscreen.innerHTML = `
                    <div class="login-interface">
                        <h2 class="login-title">火星任务：船员登入</h2>
                        <p class="instructions">输入ID (如WANG)，再输入拼接的激活码 (如87657871)。</p>
                        
                        <div class="login-form">
                            <div class="input-group">
                                <label for="crew-id">船员ID (大写字母)</label>
                                <input id="crew-id" type="text" class="holo-input" style="text-transform:uppercase;">
                            </div>
                            <div class="input-group">
                                <label for="crew-code">激活码 (拼接ASCII)</label>
                                <input id="crew-code" type="text" class="holo-input">
                            </div>
                            <button id="board-btn" class="holo-button">确认登船</button>
                        </div>
                        
                        <p id="status-message"></p>

                        <div id="boarded-crew-list">
                            <h3>已登船名单</h3>
                            <ul id="crew-names">
                                <!-- 已登船船员将出现在这里 -->
                            </ul>
                        </div>

                        <button id="launch-btn" class="holo-button launch-button hidden">启动发射程序</button>
                    </div>
                `;
                
                document.getElementById('board-btn').addEventListener('click', handleBoarding);
                document.getElementById('launch-btn').addEventListener('click', () => {
                    gameContainer.classList.add('hidden');
                    playLaunchSequence();
                });
                
                document.getElementById('crew-id').focus();
            }
            
            function handleBoarding() {
                const idInput = document.getElementById('crew-id');
                const codeInput = document.getElementById('crew-code');
                const statusMessage = document.getElementById('status-message');

                const crewId = idInput.value.toUpperCase();
                const crewCode = codeInput.value;

                // --- 核心逻辑更新 ---

                // 1. 验证ID是否为非空的大写字母字符串
                if (!/^[A-Z]+$/.test(crewId)) {
                    showStatus("错误：船员ID必须为大写英文字母。", "error");
                    return;
                }
                
                // 2. [已移除] 不再检查ID是否重复

                // 3. 根据ID动态生成正确的拼接ASCII码
                const expectedCode = crewId.split('').map(char => char.charCodeAt(0)).join('');

                // 4. 将用户输入的激活码与正确码进行比对
                if (crewCode === expectedCode) {
                    // 验证成功
                    boardedCrew.push(crewId);
                    updateBoardedList();
                    showStatus(`身份已确认: 欢迎船员 ${crewId}！`, "success");
                    idInput.value = '';
                    codeInput.value = '';
                    idInput.focus();
                    
                    document.getElementById('launch-btn').classList.remove('hidden');
                } else {
                    // 验证失败
                    showStatus("验证失败：ID或激活码不匹配。", "error");
                    codeInput.value = ''; // 仅清空密码，方便重试
                }
            }

            function updateBoardedList() {
                const crewList = document.getElementById('crew-names');
                crewList.innerHTML = '';
                boardedCrew.forEach(crewId => {
                    const listItem = document.createElement('li');
                    listItem.textContent = crewId;
                    crewList.appendChild(listItem);
                });
                // 自动滚动到列表底部
                crewList.scrollTop = crewList.scrollHeight;
            }

            function showStatus(message, type) {
                const statusMessage = document.getElementById('status-message');
                statusMessage.textContent = message;
                statusMessage.className = type === 'success' ? 'status-success' : 'status-error';
            }

            function generateAsciiTable() {
                let html = '<tbody>';
                for (let i = 0; i < CHARS.length; i += 2) {
                    html += `<tr><td>${CHARS[i]}</td><td>${CHARS[i].charCodeAt(0)}</td> <td class="gutter"></td>`;
                    if (CHARS[i+1]) { html += `<td>${CHARS[i+1]}</td><td>${CHARS[i+1].charCodeAt(0)}</td>`; } 
                    else { html += '<td></td><td></td>'; }
                    html += '</tr>';
                }
                asciiTable.innerHTML = html;
            }
            
            // --- 史诗级动画 (无修改) ---
            function playLaunchSequence() {
                const animText = document.getElementById('animation-text');
                const rocket = document.getElementById('rocket');
                const planetEarth = document.getElementById('planet-earth');
                const planetMars = document.getElementById('planet-mars');
                const solarSystemDiv = document.getElementById('solar-system');
                solarSystemDiv.classList.remove('hidden');
                
                let startTime = null;
                const totalDuration = 7000;
                let finalMessageShown = false;
                
                const solarSystemCenterX = solarSystemDiv.offsetWidth / 2;
                const solarSystemCenterY = solarSystemDiv.offsetHeight / 2;
                const vmin = Math.min(window.innerWidth, window.innerHeight) / 100;
                
                const earthOrbitRadius = 30 * vmin;
                const marsOrbitRadius = 45 * vmin;
                const earthSpeed = 0.4;
                const marsSpeed = 0.2;

                let earthAngle = 0;
                let marsAngle = 90;
                let dockingOffset = { x: null, y: null };

                let rocketState = { 
                    x: 0, y: 0, angle: 0, speed: 0, 
                    maxSpeed: 3.5, phase: 'docked_earth'
                };
                
                function animate(currentTime) {
                    if (!startTime) startTime = currentTime;
                    const elapsed = currentTime - startTime;

                    earthAngle = (earthAngle + earthSpeed) % 360;
                    marsAngle = (marsAngle + marsSpeed) % 360;
                    
                    const earthX = solarSystemCenterX + earthOrbitRadius * Math.cos(earthAngle * Math.PI / 180);
                    const earthY = solarSystemCenterY + earthOrbitRadius * Math.sin(earthAngle * Math.PI / 180);
                    planetEarth.style.transform = `translate(${earthX - planetEarth.offsetWidth/2}px, ${earthY - planetEarth.offsetHeight/2}px)`;

                    const marsX = solarSystemCenterX + marsOrbitRadius * Math.cos(marsAngle * Math.PI / 180);
                    const marsY = solarSystemCenterY + marsOrbitRadius * Math.sin(marsAngle * Math.PI / 180);
                    planetMars.style.transform = `translate(${marsX - planetMars.offsetWidth/2}px, ${marsY - planetMars.offsetHeight/2}px)`;

                    if (elapsed > totalDuration && !finalMessageShown) {
                         showText(animText, "已抵达火星轨道。任务成功！");
                         finalMessageShown = true;
                    }
                    if(elapsed > 3000 && rocketState.phase === 'docked_earth') rocketState.phase = 'grand_tour';
                    
                    switch(rocketState.phase) {
                        case 'docked_earth':
                            rocket.style.opacity = '1';
                            rocketState.x = earthX;
                            rocketState.y = earthY;
                            rocketState.angle = marsAngle + 90;
                            rocketState.x += Math.cos(rocketState.angle * Math.PI / 180) * 30;
                            rocketState.y += Math.sin(rocketState.angle * Math.PI / 180) * 30;
                            break;
                        
                        case 'grand_tour':
                            const targetX = marsX;
                            const targetY = marsY;
                            const deltaX = targetX - rocketState.x;
                            const deltaY = targetY - rocketState.y;
                            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                            const stoppingDistance = 1;

                            if (distance <= stoppingDistance) {
                                rocketState.phase = 'docked_mars';
                                dockingOffset.x = rocketState.x - marsX;
                                dockingOffset.y = rocketState.y - marsY;
                            }
                            
                            rocketState.angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
                            if (rocketState.speed < rocketState.maxSpeed) rocketState.speed += 0.05;
                            rocketState.x += Math.cos(rocketState.angle * Math.PI / 180) * rocketState.speed;
                            rocketState.y += Math.sin(rocketState.angle * Math.PI / 180) * rocketState.speed;
                            break;
                        
                        case 'docked_mars':
                            if (rocketState.speed > 0) {
                                rocketState.speed = 0;
                                document.body.classList.remove('rocket-thrust');
                            }
                            rocketState.x = marsX;
                            rocketState.y = marsY;
                            rocketState.angle = marsAngle + 90;
                            rocketState.x += Math.cos(rocketState.angle * Math.PI / 180) * 30;
                            rocketState.y += Math.sin(rocketState.angle * Math.PI / 180) * 30;
                            break;
                    }
                    
                    rocket.style.left = `${rocketState.x}px`;
                    rocket.style.top = `${rocketState.y}px`;
                    rocket.style.transform = `translate(-50%, -50%) rotate(${rocketState.angle}deg)`;
                    
                    animationFrameId = requestAnimationFrame(animate);
                }
                
                showText(animText, "所有船员已登船...准备脱离地球轨道...");
                setTimeout(() => { 
                    showText(animText, "主引擎点火！正在进行霍曼转移...");
                    document.body.classList.add('rocket-thrust');
                }, 3000);
                 setTimeout(() => { 
                    showText(animText, "接近目标...切入火星引力捕获轨道！");
                }, 5000); 
                
                animationFrameId = requestAnimationFrame(animate);
            }

            function showText(element, text) {
                element.style.opacity = '0';
                setTimeout(() => {
                    element.textContent = text;
                    element.style.opacity = '1';
                }, 300);
            }
        });
    </script>
</body>
</html>