<!doctype html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>U1ï½œæ‰¾ä¸åŒï¼šcout / åˆ†å· / æ‹¬å· / å˜é‡ a</title>
    <link rel="stylesheet" href="common.css">
</head>

<body>
    <header>
        <h1>
            <span class="emoji">ğŸ§¸ğŸˆ</span>U1ï¼šæ‰¾ä¸åŒï¼
        </h1>
        <div class="toolbar">
            <span class="badge">â±ï¸ æ—¶é—´ï¼š<span id="timer">60</span>s</span>
            <span class="badge">â­ åˆ†æ•°ï¼š<span id="score">0</span>
            </span>
            <span class="badge">ğŸ† æœ€é«˜åˆ†ï¼š<span id="high">0</span>
            </span>
            <button id="resetBtn" class="btn">é‡æ–°æ¸¸æˆ</button>
        </div>
    </header>
    <main>
        <p id="desc" class="big"></p>
        <button id="nextBtn" class="btn" style="padding:6px 10px;font-size:14px;margin:6px 0 12px 0">ä¸‹ä¸€å…³</button>
        <div class="board">
            <section class="panel">
                <h2>é”™è¯¯ä»£ç ï¼ˆç‚¹å‡»æ‰¾ä¸åŒï¼‰</h2>
                <div id="left" class="code">
                </div>
            </section>
            <section class="panel">
                <h2>æ­£ç¡®ä»£ç ï¼ˆå¯¹ç…§å‚è€ƒï¼‰</h2>
                <div id="right" class="code">
                </div>
            </section>
        </div>
        <div class="tip">æç¤ºï¼š<b>;</b> åˆ†å·åˆ«å¿˜äº†ï¼›<b>(){}</b> æ‹¬å·è¦é…å¯¹ï¼›<b>cout</b> ç”¨ <code>&lt;&lt;</code> å¾€å·¦å·¦å·¦ï¼å˜é‡ <b>a</b>
            è¦å…ˆæ­£ç¡®å®šä¹‰å†è¾“å‡ºã€‚</div>

        <div class="footer">å®Œæˆåå¯ç‚¹å‡»â€œå†æ¥ä¸€å±€â€åˆ·æ–°é¢˜ç›®ã€‚åŠ æ²¹å°å°ç¨‹åºå‘˜ï¼<span class="cute">ğŸŒŸğŸ­</span></div>
    </main>
    <script>
        (function () {
            "use strict";
            const leftEl = document.getElementById("left"), rightEl = document.getElementById("right"), scoreEl = document.getElementById("score"), timerEl = document.getElementById("timer"), highEl = document.getElementById("high"), resetBtn = document.getElementById("resetBtn"), nextBtn = document.getElementById("nextBtn");

            const puzzles = [
                {
                    right: ["#include <iostream>", "using namespace std;", "int main(){", "    int a = 8;", "    int b = 2;", "    int sum = a + b;", "    cout << \"a=\" << a << \", sum=\" << sum << endl;", "    return 0;", "}"],
                    left: ["#include <iostream>", "using namespace std;", "int main){", "    inta a = 8;", "    int b = 2", "    int sum = a + b;", "    cout < \"a=\" << a << \", sum=\" << sum << end;", "    return 0;", "}"],
                    diffs: [3, 4, 5, 7],
                    hints: {
                        3: "main å‡½æ•°ç¼ºå°‘æ‹¬å·ï¼šåº”ä¸º int main()",
                        4: "ç±»å‹æˆ–å˜é‡åæ‹¼å†™é”™è¯¯ï¼šåº”ä¸º int a = 8;",
                        5: "å°‘äº†è¡Œæœ«åˆ†å·ï¼šåº”ä¸º int b = 2;",
                        7: "cout è¿ç®—ç¬¦ä¸ endl é”™è¯¯ï¼šåº”ä¸º << å’Œ endl"
                    }
                },
                {
                    right: ["#include <iostream>", "using namespace std;", "int main(){", "    int x = 3;", "    int y = 4;", "    cout << x + y << endl;", "    return 0;", "}"],
                    left: ["#include <iostream>", "using namespace std;", "int main(){", "    int x = ;", "    int y = 4", "    cout < x + y << end;", "    return 0", "}"],
                    diffs: [4, 5, 6, 7],
                    hints: {
                        4: "å˜é‡åˆå§‹åŒ–ç¼ºå°‘å€¼ï¼šåº”ä¸º int x = 3;",
                        5: "è¡Œæœ«ç¼ºå°‘åˆ†å·ï¼šåº”ä¸º int y = 4;",
                        6: "cout è¿ç®—ç¬¦æˆ– endl é”™è¯¯ï¼šåº”ä¸º cout << x + y << endl;",
                        7: "return è¯­å¥ç¼ºå°‘åˆ†å·ï¼šåº”ä¸º return 0;"
                    }
                },
                {
                    right: ["#include <iostream>", "using namespace std;", "int main(){", "    int a = 5;", "    int b = 7;", "    int c = a * b;", "    cout << \"c=\" << c << endl;", "    return 0;", "}"],
                    left: ["#include <iostream>", "using namespace std;", "int main){", "    int a = 5", "    int b == 7;", "    int c = a ** b;", "    cout << \"c=\" < c << end;", "    return 0;", "}"],
                    diffs: [3, 4, 5, 6, 7],
                    hints: {
                        3: "main æ‹¬å·é”™è¯¯ï¼šåº”ä¸º int main()",
                        4: "ç¼ºå°‘åˆ†å·ï¼šåº”ä¸º int a = 5;",
                        5: "èµ‹å€¼é”™è¯¯ï¼šåº”ä¸º = è€Œä¸æ˜¯ ==",
                        6: "ä¹˜æ³•è¿ç®—ç¬¦æ˜¯ *ï¼Œä¸æ˜¯ **",
                        7: "cout è¿ç®—ç¬¦æˆ– endl é”™è¯¯ï¼šåº”ä¸º << å’Œ endl"
                    }
                },
                {
                    right: ["#include <iostream>", "using namespace std;", "int main(){", "    int n = 10;", "    cout << n << endl;", "    return 0;", "}"],
                    left: ["#include <iostream>", "using namespace std;", "int main(){", "    inta n = 10;", "    cout >> n << endl", "    return 0;", "}"],
                    diffs: [4, 5],
                    hints: {
                        4: "ç±»å‹æ‹¼å†™é”™è¯¯ï¼šåº”ä¸º int n = 10;",
                        5: "cout æ–¹å‘é”™è¯¯æˆ–ç¼ºå°‘åˆ†å·ï¼šåº”ä¸º cout << n << endl;"
                    }
                }
            ];

            let rightLines = [], leftLines = [], differences = new Set(), hints = {}, found = new Set();
            let score = 0, total = 0, timeLeft = 60, timerId = null;
            let gameEnded = false;
            let cumulative = 0; // åˆ·æ–°é¡µé¢æ—¶é‡ç½®ç´¯è®¡åˆ†æ•°ä¸º 0
            localStorage.setItem('u1_total', '0');
            const descEl = document.getElementById('desc');

            function pickPuzzle() {
                const p = puzzles[Math.floor(Math.random() * puzzles.length)];
                rightLines = p.right;
                leftLines = p.left;
                differences = new Set(p.diffs);
                hints = p.hints || {};
                total = differences.size;
                descEl.innerHTML = `è§„åˆ™ï¼šç‚¹å‡»å·¦ä¾§â€œé”™è¯¯ä»£ç â€çš„é”™è¯¯è¡Œï¼Œæ‰¾å‡º <b>${total} å¤„</b>å¸¸è§é”™è¯¯ã€‚<span class="cute">ğŸ¦„ğŸ±</span> æ‰¾å¯¹ +2 åˆ†ï¼Œç‚¹é”™ <b>-3</b> åˆ†ï¼Œ60 ç§’å€’è®¡æ—¶ï¼`;
            }

            function render() {
                leftEl.innerHTML = "";
                rightEl.innerHTML = "";
                for (let i = 0; i < Math.max(leftLines.length, rightLines.length); i++) {
                    const leftTxt = leftLines[i] ?? '';
                    const rightTxt = rightLines[i] ?? '';

                    const rowL = document.createElement('div');
                    rowL.className = 'line';
                    rowL.dataset.idx = String(i + 1);
                    rowL.innerHTML = `<span class=\"ln\">${i + 1}</span><code>${escapeHtml(leftTxt)}</code>`;
                    rowL.addEventListener('click', () => onClick(i + 1, rowL));
                    leftEl.appendChild(rowL);

                    const rowR = document.createElement('div');
                    rowR.className = 'line muted';
                    rowR.innerHTML = `<span class=\"ln\">${i + 1}</span><code>${escapeHtml(rightTxt)}</code>`;
                    rightEl.appendChild(rowR);
                }
                updateScore()
            }

            function escapeHtml(s) { return s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;") }

            function showHint(row, msg) {
                const tip = document.createElement('span');
                tip.className = 'hint';
                tip.style.marginLeft = '8px';
                tip.style.color = 'red';
                tip.textContent = `æç¤ºï¼š${msg}`;
                row.appendChild(tip);
                setTimeout(() => { tip.remove() }, 3200);
            }

            function onClick(lineNumber, row) {
                if (gameEnded || found.has(lineNumber) || timeLeft <= 0) { return }
                if (differences.has(lineNumber)) {
                    found.add(lineNumber);
                    row.classList.remove("wrong");
                    row.classList.add("correct");
                    score += 2;
                    cumulative = Math.max(0, cumulative + 2);
                    localStorage.setItem('u1_total', String(cumulative));
                    flashStars(row);
                    // ç¦æ­¢å†æ¬¡ç‚¹å‡»å·²ç­”å¯¹çš„è¡Œ
                    row.style.pointerEvents = 'none';
                    if (hints[lineNumber]) { showHint(row, hints[lineNumber]) }
                } else {
                    row.classList.add("wrong");
                    score = Math.max(0, score - 3);
                    cumulative = Math.max(0, cumulative - 3);
                    localStorage.setItem('u1_total', String(cumulative));
                }
                updateScore();
                if (found.size === total) { win() }
            }

            function updateScore() { scoreEl.textContent = String(cumulative) }

            function flashStars(row) { const s = document.createElement('span'); s.className = 'stars'; s.textContent = ' âœ¨â­ '; row.appendChild(s); setTimeout(() => { s.remove() }, 600) }

            function tick() { timeLeft--; timerEl.textContent = String(timeLeft); if (timeLeft <= 10) { timerEl.style.color = '#ef476f' } if (timeLeft <= 0) { clearInterval(timerId); timerId = null; gameOver(false) } }

            function startTimer() { clearTimer(); timeLeft = 60; timerEl.textContent = String(timeLeft); timerEl.style.color = '#d90429'; timerId = setInterval(tick, 1000) }
            function clearTimer() { if (timerId) { clearInterval(timerId); timerId = null } }

            function win() { /* ä¸æ¸…é™¤è®¡æ—¶å™¨ï¼Œä¿æŒå€’è®¡æ—¶è¿›è¡Œ */ confetti(); gameOver(true) }

            function updateHighWith(candidate) {
                const bestRaw = localStorage.getItem('u1_high');
                const best = parseInt(bestRaw || '0', 10) || 0;
                const newBest = candidate > best ? candidate : best;
                if (newBest !== best) { localStorage.setItem('u1_high', String(newBest)) }
                highEl.textContent = String(newBest);
            }

            function gameOver(victory) {
                gameEnded = true;
                const msg = victory ? "å¤ªæ£’å•¦ï¼å…¨éƒ¨æ‰¾å¯¹ï¼" : "æ—¶é—´åˆ°ï¼å†è¯•ä¸€æ¬¡~";
                const overlay = document.createElement('div');
                overlay.style.position = 'fixed'; overlay.style.inset = '0'; overlay.style.background = 'rgba(0,0,0,0.4)'; overlay.style.display = 'flex'; overlay.style.alignItems = 'center'; overlay.style.justifyContent = 'center'; overlay.style.zIndex = '9999';
                const card = document.createElement('div');
                card.style.background = '#fff'; card.style.border = '4px solid #ffd166'; card.style.borderRadius = '16px'; card.style.padding = '20px 24px'; card.style.fontSize = '20px'; card.style.color = '#102a43';
                card.innerHTML = `<div style=\"text-align:center\">${victory ? 'ğŸ‰' : 'â°'} ${msg}<br/>æ€»åˆ†ï¼š<b>${cumulative}</b></div>`;
                overlay.appendChild(card); document.body.appendChild(overlay);
                updateHighWith(cumulative);
                overlay.addEventListener('click', () => { overlay.remove() })
            }

            function confetti() { const n = 80; for (let i = 0; i < n; i++) { const p = document.createElement('div'); p.textContent = ['ğŸˆ', 'â­', 'ğŸ€', 'ğŸ­', 'ğŸ§¸'][Math.floor(Math.random() * 5)]; p.style.position = 'fixed'; p.style.left = Math.random() * 100 + '%'; p.style.top = '-10%'; p.style.fontSize = (18 + Math.random() * 10) + 'px'; p.style.transition = 'transform 1.2s linear, top 1.2s linear, opacity 1.2s'; document.body.appendChild(p); setTimeout(() => { p.style.top = '110%'; p.style.transform = 'rotate(' + (Math.random() * 360) + 'deg)'; p.style.opacity = '0' }, 10); setTimeout(() => p.remove(), 1400) } }

            function reset() {
                found = new Set();
                // é‡ç½®å‰æ›´æ–°æœ€é«˜åˆ†ï¼ˆä½¿ç”¨æ€»åˆ†ï¼‰
                updateHighWith(cumulative);
                score = 0;
                cumulative = 0;
                localStorage.setItem('u1_total', '0');
                document.querySelectorAll('.line').forEach(el => el.classList.remove('correct', 'wrong'));
                pickPuzzle();
                render();
                updateScore();
                startTimer()
                gameEnded = false;
                // é‡ç½®ååˆ·æ–°æœ€é«˜åˆ†æ˜¾ç¤º
                highEl.textContent = String(parseInt(localStorage.getItem('u1_high') || '0', 10) || 0);
            }

            resetBtn.addEventListener("click", reset);
            nextBtn.addEventListener("click", () => {
                // åˆ‡æ¢é¢˜ç›®ä½†ä¿æŒå€’è®¡æ—¶ç»§ç»­ï¼›å¦‚æœå·²åœæ­¢åˆ™é‡æ–°å¯åŠ¨
                found = new Set();
                score = 0; // æœ¬å…³å¾—åˆ†æ¸…é›¶ï¼Œé¿å…å¼¹çª—æ˜¾ç¤ºç´¯è®¡
                document.querySelectorAll('.line').forEach(el => { el.classList.remove('correct','wrong'); el.style.removeProperty('pointer-events'); });
                pickPuzzle();
                render();
                // ä¸é‡ç½®è®¡æ—¶ï¼›å³ä½¿å·²ç»“æŸä¹Ÿä¸åœ¨æ­¤å¯åŠ¨ï¼Œåªæœ‰â€œé‡æ–°æ¸¸æˆâ€æ‰é‡ç½®/å¯åŠ¨
                gameEnded = false;
            });
            highEl.textContent = String(parseInt(localStorage.getItem('u1_high') || '0', 10) || 0);
            scoreEl.textContent = String(cumulative);
            pickPuzzle();
            render();
            startTimer();

            // åˆ·æ–°/å…³é—­é¡µé¢å‰ï¼Œç”¨å½“å‰æœ¬å…³åˆ†æ•°å°è¯•æ›´æ–°æœ€é«˜åˆ†
            window.addEventListener('beforeunload', () => {
                try { updateHighWith(cumulative); } catch (e) {}
            });
        })();
    </script>
</body>

</html>

